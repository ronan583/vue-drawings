(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d4d80a5"],{"2d57":function(t,e,i){"use strict";i("94b1")},3339:function(t,e,i){},"94b1":function(t,e,i){},a631:function(t,e,i){"use strict";i("3339")},c227:function(t,e,i){"use strict";i.r(e);var s,o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"jzb-flexpage-vertical jzb-page filemain"},[e("header",[e("van-field",{staticClass:"company",attrs:{"is-link":"",readonly:"",label:"选择合同段",placeholder:"选择合同段"},on:{click:t.openChooseProjContWin},model:{value:t.projectContName,callback:function(e){t.projectContName=e},expression:"projectContName"}}),e("div",{staticClass:"flex-between"},[e("form",{staticStyle:{width:"100%"},attrs:{action:""}},[e("van-search",{staticClass:"flex1",attrs:{placeholder:"请输入目录/资料名称关键字搜索"},on:{blur:t.onSearch,focus:t.onFocus,clear:t.handleClearSearch},model:{value:t.searchValue,callback:function(e){t.searchValue="string"===typeof e?e.trim():e},expression:"searchValue"}})],1),e("van-button",{staticStyle:{width:"50px","margin-right":"10px"},attrs:{type:"info",size:"small"},on:{click:t.onSearch}},[t._v(" 搜索 ")])],1)],1),e("main",{staticClass:"mainauto"},[e("FilePathList",{attrs:{list:t.mainPathList},on:{click:t.onClickPath}}),e("div",{staticClass:"u-gap"}),e("div",{staticClass:"file-block",style:{height:t.isShowOptBtns||t.isShowAddBtns?"calc(100% - 130px)":"calc(100% - 60px)"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.searchShow,expression:"searchShow"}],staticClass:"result-wrap"},[e("div",{staticClass:"result-part"},[t._v("搜索结果 ("+t._s(t.searchResultCount)+")")])]),e("van-checkbox-group",{ref:"checkGroup",staticClass:"checkbox-group",on:{change:t.handleCheckChange},model:{value:t.checkboxResult,callback:function(e){t.checkboxResult=e},expression:"checkboxResult"}},[e("van-cell-group",{staticClass:"cell-group"},[t._l(t.fileCatalogList,(function(i,s){return e("van-cell",{key:i.id,staticClass:"cell-item",attrs:{clickable:""},on:{click:function(e){return t.onClickCell(i)}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[e("div",{directives:[{name:"show",rawName:"v-show",value:!["NEWGROUP","NOGROUP"].includes(i.type),expression:"!['NEWGROUP', 'NOGROUP'].includes(item.type)"}],staticStyle:{width:"40px"},on:{click:function(e){return e.stopPropagation(),t.handleCheckClick.apply(null,arguments)}}},[e("van-checkbox",{staticStyle:{"justify-content":"center"},attrs:{name:s,"label-disabled":""}})],1)]},proxy:!0}],null,!0)},[e("div",{staticClass:"cell-item-icon"},[e("van-icon",{staticClass:"iconfont catalog-icon",attrs:{"class-prefix":"icon",name:t.resTypeToIcon(i.type).name,size:"32px",color:t.resTypeToIcon(i.type).color}})],1),e("div",{staticClass:"cell-item-up"},[e("div",{staticClass:"cell-item--title"},[t._v(t._s(i.resId||!i.resTotal&&0!==i.resTotal?i.title:`${i.title}（${i.resTotal}）`))]),e("div",{staticClass:"cell-item--desc"},[e("span",[t._v(t._s(i.modifiedTime))])]),e("div",{staticClass:"cell-item--desc"},[e("span",{staticClass:"item-span--desc",on:{click:function(e){return e.stopPropagation(),t.onClickCellPath(i)}}},[t._v(t._s(i.path))]),e("span")])])])})),t.fileCatalogList.length<1?e("van-empty",{attrs:{description:"暂无数据"}}):t._e()],2)],1)],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isUploadShow,expression:"isUploadShow"}],staticClass:"upload-view",staticStyle:{"pointer-events":"none"}},[e("van-icon",{staticClass:"iconfont add-btn",staticStyle:{"pointer-events":"visiblePainted"},attrs:{"class-prefix":"icon",name:"Icon-Upload",size:"64px",color:"rgb(25, 137, 249)"},on:{click:t.onClickAdd}})],1),e("van-popup",{staticClass:"opt-btns-view opt-view",attrs:{lockScroll:!1,round:"",overlay:!1,position:"bottom",duration:"0.1"},model:{value:t.isShowOptBtns,callback:function(e){t.isShowOptBtns=e},expression:"isShowOptBtns"}},t._l(t.optConfig,(function(i){return e("div",{directives:[{name:"show",rawName:"v-show",value:i.availible,expression:"item.availible"}],key:i.name},[e("van-button",{staticClass:"opt-btn",attrs:{plain:"",block:""},on:{click:i.operation}},[e("van-icon",{staticClass:"iconfont btn-icon",attrs:{"class-prefix":"icon",name:t.resTypeToIcon(i.name).name,size:"20px",color:t.resTypeToIcon(i.name).color}}),t._v(" "+t._s(i.text)+" ")],1)],1)})),0),e("van-popup",{staticClass:"opt-btns-view add-view",attrs:{round:"","overlay-style":{background:"rgba(0,0,0,0.4)"},position:"bottom",duration:"0.1"},on:{"click-overlay":function(e){t.isUploadShow=!0}},model:{value:t.isShowAddBtns,callback:function(e){t.isShowAddBtns=e},expression:"isShowAddBtns"}},[e("div",{staticClass:"btn-view"},[e("van-button",{staticClass:"opt-btn",attrs:{plain:"",block:""},on:{click:t.onAddFolder}},[e("van-icon",{staticClass:"iconfont btn-icon",attrs:{"class-prefix":"icon",name:t.resTypeToIcon("folder").name,size:"24px",color:t.resTypeToIcon("folder").color}}),t._v(" 新建文件夹 ")],1)],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isUploadBtnShow,expression:"isUploadBtnShow"}],staticClass:"btn-view"},[e("van-uploader",{attrs:{accept:"application/acad,.dwg,.cpx,.zjxm,.gbq6,.gqi4,.gtj,.qdg4,.cgc,.hntbj,.dxf,.dwf,.dwt,.bak","before-read":t.beforeRead,"after-read":t.handlerAfterRead,"max-count":9,"max-size":t.FILE_MAX_SIZE,multiple:""},on:{oversize:t.onOversize}},[e("van-button",{staticClass:"opt-btn",attrs:{plain:"",block:""}},[e("van-icon",{staticClass:"iconfont btn-icon",attrs:{"class-prefix":"icon",name:t.resTypeToIcon("dwg").name,size:"25px",color:t.resTypeToIcon("dwg").color}}),t._v(" 上传文件 ")],1)],1)],1)]),e("van-popup",{style:{height:"85%",overflow:"hidden"},attrs:{round:"",closeable:"",position:"bottom"},model:{value:t.showMoveFilePropup,callback:function(e){t.showMoveFilePropup=e},expression:"showMoveFilePropup"}},[e("div",{staticClass:"pop-title"},[t._v("调拨文件")]),e("div",{staticClass:"pop-desc"},[t._v(t._s(`将已选择的${t.checkboxResult.length}项移动到当前位置`))]),e("div",{staticClass:"move-propup-hd"},[e("FilePathList",{attrs:{list:t.filePathList},on:{click:t.handlerPathClick}})],1),e("div",{staticClass:"move-propup-container"},[e("van-cell-group",t._l(t.moveTargetDirList,(function(i){return e("van-cell",{key:i.dirId,staticClass:"cell-item",attrs:{clickable:""},on:{click:function(e){return t.onClickDir(i)}}},[e("div",{staticClass:"cell-item-icon"},[e("van-icon",{staticClass:"iconfont catalog-icon",attrs:{"class-prefix":"icon",name:t.resTypeToIcon(i.type).name,size:"30px",color:t.resTypeToIcon(i.type).color}})],1),e("div",{staticClass:"cell-item-up"},[e("div",{staticClass:"cell-item--title"},[t._v(t._s(i.dirName))])])])})),1)],1),e("div",{staticClass:"btns"},[e("van-button",{attrs:{type:"info",block:""},on:{click:t.confimMove}},[t._v("确认")])],1)]),e("van-popup",{staticClass:"edit-popup",attrs:{round:"","close-on-click-overlay":!1},on:{closed:t.onEditPopupClose},model:{value:t.isEditFileShow,callback:function(e){t.isEditFileShow=e},expression:"isEditFileShow"}},[e("div",{staticClass:"pop-title"},[t._v(t._s(t.getEditFormTitle()))]),e("van-form",{ref:"editForm",attrs:{"validate-first":""},on:{failed:t.onFailed,submit:t.confirmEdit}},[e("van-field",{staticClass:"edit-field",attrs:{label:"名称",name:"validator",placeholder:"请输入名称",rules:[{validator:t.editValidator,message:"输入内容不得为空，长度不超过30字符",required:!0,trigger:"onChange"}]},model:{value:t.editValue,callback:function(e){t.editValue="string"===typeof e?e.trim():e},expression:"editValue"}}),e("div",{staticClass:"van-dialog__footer"},[e("div",{staticClass:"edit-btn"},[e("van-button",{staticStyle:{"border-bottom-left-radius":"16px"},attrs:{block:"",type:"default","native-type":"button"},on:{click:t.onEditPopupClose}},[t._v("取消")])],1),e("div",{staticClass:"edit-btn edit-submit"},[e("van-button",{staticStyle:{"border-bottom-right-radius":"16px"},attrs:{block:"",type:"default","native-type":"submit"}},[t._v("提交")])],1)])],1)],1)],1)])},a=[],c=new Uint8Array(16);function r(){if(!s&&(s="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(c)}var l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function n(t){return"string"===typeof t&&l.test(t)}for(var d=n,h=[],p=0;p<256;++p)h.push((p+256).toString(16).substr(1));function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!d(i))throw TypeError("Stringified UUID is invalid");return i}var f=u;function m(t,e,i){t=t||{};var s=t.random||(t.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var o=0;o<16;++o)e[i+o]=s[o];return e}return f(s)}var g=m,b=i("3089"),y=i("f350");const C={batchGetBrief:(t={},e={})=>Object(y["c"])("/project/project/batchGetBrief",t,e),create:(t={},e={})=>Object(y["c"])("/project/project/create",t,e),delete:(t={},e={})=>Object(y["c"])("/project/project/delete",t,e),get:(t={},e={})=>Object(y["c"])("/project/project/get",t,e),getBrief:(t={},e={})=>Object(y["c"])("/project/project/getBrief",t,e),getPm:(t={},e={})=>Object(y["c"])("/project/project/getPm",t,e),importExcel:(t={},e={})=>Object(y["c"])("/project/project/importExcel",t,e),listBrief:(t={},e={})=>Object(y["c"])("/project/project/listBrief",t,e),listContracts:(t={},e={})=>Object(y["c"])("/project/project/listContracts",t,e),listPaged:(t={},e={})=>Object(y["c"])("/project/project/listPaged",t,e),update:(t={},e={})=>Object(y["c"])("/project/project/update",t,e)};var v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"path-wrap"},[e("div",{staticClass:"path-part"},t._l(t.list,(function(i,s){return e("span",{key:i.dirId,staticClass:"path-span"},[e("span",{class:{"path-last-span":s>0&&t.list.length===s+1},on:{click:function(e){return t.$emit("click",s)}}},[t._v(t._s(i.dirName))]),e("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.list.length-1>s,expression:"list.length - 1 > index"}],staticClass:"iconfont",staticStyle:{"margin-left":"5px"},attrs:{"class-prefix":"icon",name:"jzb-app-pointsto",size:"12px",color:"rgb(172, 171, 180)"}})],1)})),0)])},I=[],w={name:"FilePathList",props:{list:{type:Array,default:()=>[]},separator:{type:String,default:">"}}},k=w,j=(i("2d57"),i("2877")),O=Object(j["a"])(k,v,I,!1,null,"3aa8b848",null),P=O.exports;const T={uploadBiz:(t={},e={})=>Object(y["c"])("/file/fileupload/uploadBiz",t,e),uploadBizMulti:(t={},e={},i)=>Object(y["c"])("/file/fileupload/uploadBizMulti"+i,t,e),uploadOpen:(t={},e={})=>Object(y["c"])("/file/fileupload/uploadOpen",t,e),uploadOpenMulti:(t={},e={})=>Object(y["c"])("/file/fileupload/uploadOpenMulti",t,e),uploadSecure:(t={},e={})=>Object(y["c"])("/file/fileupload/uploadSecure",t,e),uploadSecureMulti:(t={},e={})=>Object(y["c"])("/file/fileupload/uploadSecureMulti",t,e),uploadTemp:(t={},e={})=>Object(y["c"])("/file/fileupload/uploadTemp",t,e),uploadTempMulti:(t={},e={})=>Object(y["c"])("/file/fileupload/uploadTempMulti",t,e)},D={acrossCopy:(t={},e={})=>Object(y["c"])("/file/dir/acrossCopy",t,e),multiMove:(t={},e={})=>Object(y["c"])("/file/dir/multiMove",t,e),batchRemove:(t={},e={})=>Object(y["c"])("/file/dir/batchRemove",t,e),batchUpdate:(t={},e={})=>Object(y["c"])("/file/dir/batchUpdate",t,e),clear:(t={},e={})=>Object(y["c"])("/file/dir/clear",t,e),copy:(t={},e={})=>Object(y["c"])("/file/dir/copy",t,e),create:(t={},e={})=>Object(y["c"])("/file/dir/create",t,e),createBucket:(t={},e={})=>Object(y["c"])("/file/dir/createBucket",t,e),createTree:(t={},e={})=>Object(y["c"])("/file/dir/createTree",t,e),dirResCount:(t={},e={})=>Object(y["c"])("/file/dir/dirResCount",t,e),exportExcel:(t={},e={})=>Object(y["c"])("/file/dir/exportExcel",t,e),get:(t={},e={})=>Object(y["c"])("/file/dir/get",t,e),getByPath:(t={},e={})=>Object(y["c"])("/file/dir/getByPath",t,e),importExcel:(t={},e={})=>Object(y["c"])("/file/dir/importExcel",t,e),impt:(t={},e={})=>Object(y["c"])("/file/dir/impt",t,e),init:(t={},e={})=>Object(y["c"])("/file/dir/init",t,e),list:(t={},e={})=>Object(y["c"])("/file/dir/list",t,e),move:(t={},e={})=>Object(y["c"])("/file/dir/move",t,e),remove:(t={},e={})=>Object(y["c"])("/file/dir/remove",t,e),sort:(t={},e={})=>Object(y["c"])("/file/dir/sort",t,e),update:(t={},e={})=>Object(y["c"])("/file/dir/update",t,e),updateProps:(t={},e={})=>Object(y["c"])("/file/dir/updateProps",t,e),batchUpdateDir:(t={},e={})=>Object(y["c"])("/file/dir/batchUpdateDir",t,e),dirSearch:(t={},e={})=>Object(y["c"])("/file/dir/dirSearch",t,e),multiUpdateType:(t={},e={})=>Object(y["c"])("/file/dir/multiUpdateType",t,e),getPathByDir:(t={},e={})=>Object(y["c"])("/file/dir/getPathByDir",t,e),syncDelete:(t={},e={})=>Object(y["c"])("/file/dir/syncDelete",t,e),syncUpload:(t={},e={})=>Object(y["c"])("/file/dir/syncUpload",t,e),syncUpdate:(t={},e={})=>Object(y["c"])("/file/dir/syncUpdate",t,e),syncId:(t={},e={})=>Object(y["c"])("/file/dir/syncId",t,e),multiGetPath:(t={},e={})=>Object(y["c"])("/file/dir/multiGetPath",t,e),listAndCreateDefault:(t={},e={})=>Object(y["c"])("/file/dir/listAndCreateDefault",t,e),multiDownload:(t={},e={})=>Object(y["c"])("/file/dir/multiDownload",t,e),searchDirList:(t={},e={})=>Object(y["c"])("/file/dir/search",t,e)},x={asyncExpt:(t={},e={})=>Object(y["c"])("/file/res/asyncExpt",t,e),asyncExptHtml:(t={},e={})=>Object(y["c"])("/file/res/asyncExptHtml",t,e),batchUpdate:(t={},e={})=>Object(y["c"])("/file/res/batchUpdate",t,e),create:(t={},e={})=>Object(y["c"])("/file/res/create",t,e),get:(t={},e={})=>Object(y["c"])("/file/res/get",t,e),histories:(t={},e={})=>Object(y["c"])("/file/res/histories",t,e),impt:(t={},e={})=>Object(y["c"])("/file/res/impt",t,e),list:(t={},e={})=>Object(y["c"])("/file/res/list",t,e),listPaged:(t={},e={})=>Object(y["c"])("/file/res/listPaged",t,e),move:(t={},e={})=>Object(y["c"])("/file/res/move",t,e),recover:(t={},e={})=>Object(y["c"])("/file/res/recover",t,e),recyclebin:(t={},e={})=>Object(y["c"])("/file/res/recyclebin",t,e),relates:(t={},e={})=>Object(y["c"])("/file/res/relates",t,e),multiRemove:(t={},e={})=>Object(y["c"])("/file/res/multiRemove",t,e),remove:(t={},e={})=>Object(y["c"])("/file/res/remove",t,e),sort:(t={},e={})=>Object(y["c"])("/file/res/sort",t,e),transfer:(t={},e={})=>Object(y["c"])("/file/res/transfer",t,e),update:(t={},e={})=>Object(y["c"])("/file/res/update",t,e),delete:(t={},e={})=>Object(y["c"])("/file/res/delete",t,e),updateSort:(t={},e={})=>Object(y["c"])("/file/res/updateSort",t,e),acrossCopy:(t={},e={})=>Object(y["c"])("/file/res/acrossCopy",t,e),uploadCount:(t={},e={})=>Object(y["c"])("/file/res/uploadCount",t,e),statsUserRes:(t={},e={})=>Object(y["c"])("/file/res/statsUserRes",t,e),getComRes:(t={},e={})=>Object(y["c"])("/file/res/getComRes",t,e),getLatelyPage:(t={},e={})=>Object(y["c"])("/file/res/getLatelyPage",t,e),statsAmount:(t={},e={})=>Object(y["c"])("/file/res/statsAmount",t,e),syncDelete:(t={},e={})=>Object(y["c"])("/file/res/syncDelete",t,e),syncUpload:(t={},e={})=>Object(y["c"])("/file/res/syncUpload",t,e),syncUpdate:(t={},e={})=>Object(y["c"])("/file/res/syncUpdate",t,e),syncId:(t={},e={})=>Object(y["c"])("/file/res/syncId",t,e),asyncExptReport:(t={},e={})=>Object(y["c"])("/file/res/asyncExptReport",t,e)},R={ensure:(t={},e={})=>Object(y["c"])("/app/contApp/ensure",t,e)};var S=i("fa7d");const L={biztype:"blg/resource",FOLDER_VALUE:"FOLDER",prewFormateList:["TXT","WORD","EXCEL","PDF","IMAGE","VIDEO","AUDIO","PPT"],resourceTypeList:[{value:"",label:"全部",icon:"jzb-icon-all"},{value:"FOLDER",label:"文件夹"},{value:"WORD",label:"Word",icon:"jzb-icon-word"},{value:"EXCEL",label:"Excel",icon:"jzb-icon-excel"},{value:"PDF",label:"PDF",icon:"jzb-icon-pdf"},{value:"IMAGE",label:"图片",icon:"jzb-icon-picture"},{value:"VIDEO",label:"视频",icon:"jzb-icon-video"},{value:"AUDIO",label:"音频",icon:"jzb-icon-audio"},{value:"PPT",label:"PPT",icon:"jzb-icon-ppt"},{value:"TXT",label:"TXT",icon:"jzb-icon-txt"},{value:"ZIP",label:"压缩包",icon:"jzb-icon-other"},{value:"RAR",label:"压缩包",icon:"jzb-icon-other"},{value:"GZIP",label:"压缩包",icon:"jzb-icon-other"},{value:"CAD",label:"CAD",icon:"jzb-icon-other"},{value:"XML",label:"XML",icon:"jzb-icon-other"},{value:"UNKOWN",label:"其它",icon:"jzb-icon-other"},{value:"OTHER",label:"其它",icon:"jzb-icon-other"}],appName:{COURSE_BUCKET:"CourseBucket",RESOURCE_BUCKET:"ResourceBucket",Drawing_2D_BUCKET:"Drawing2DBucket"}},B=t=>{let e="",i="";try{const i=t.split(".");e=i[i.length-1]}catch(f){e=""}if(!e)return"UNKOWN";e=e.toLocaleLowerCase();const s=["png","jpg","jpeg"];if(i=s.find(t=>t===e),i)return"IMAGE";const o=["zip","gzip","rar"];if(i=o.find(t=>t===e),i)return"ZIP";const a=["txt"];if(i=a.find(t=>t===e),i)return"TXT";const c=["xls","xlt","et","xlsx","xltx","csv","xlsm","xltm"];if(i=c.find(t=>t===e),i)return"EXCEL";const r=["doc","dot","wps","wpt","docx","dotx","docm","dotm","rtf"];if(i=r.find(t=>t===e),i)return"WORD";const l=["pdf"];if(i=l.find(t=>t===e),i)return"PDF";const n=["ppt","pptx","pptm","ppsx","ppsm","pps","potx","potm","dpt","dps"];if(i=n.find(t=>t===e),i)return"PPT";const d=["mp4","flv","mkv","rmvb","wmv","avi","flv","webm","m4e","movie"];if(i=d.find(t=>t===e),i)return"VIDEO";const h=["mp3","midi","mid","wav","m4a","acp","aif","aiff","aifc","au","la1","lavs","lmsff","m3u"];if(i=h.find(t=>t===e),i)return"AUDIO";const p=["xml"];if(i=p.find(t=>t===e),i)return"XML";const u=["dwg","cpx","zjxm","gbq6","gqi4","gtj","qdg4","cgc","hntbj","dxf","dwf","dwt","bak"];return i=u.find(t=>t===e),i?"CAD":"OTHER"};function N(t){return new Promise((e,i)=>{fetch(t).then(t=>t.json()).then(t=>{e(t)}).catch(t=>{i(t)})})}function A(t,e={}){return new Promise((i,s)=>{fetch(t,{body:JSON.stringify(e),headers:{"content-type":"application/json"},method:"POST"}).then(t=>t.json()).then(t=>{i(t),console.log(t)}).catch(t=>{s(t)})})}function $(t,e){return new Promise((i,s)=>{fetch(t+e,{body:JSON.stringify(e),headers:{"content-type":"application/x-www-form-urlencoded"},method:"POST"}).then(t=>t.json()).then(t=>{i(t)}).catch(t=>{s(t)})})}const E="https://api.jizhibao.com.cn/net/emps",F="https://api.jizhibao.com.cn/net/emps",U={udrepor:t=>N(`${F}/UDReport/GetFinalAccount?${t}`),ProjContContract:t=>N(`${E}/ProjContContract/GetContractList?${t}`),startUpload:(t={})=>A(E+"/Upload/startUpload",t),ClearTask:(t={})=>A(E+"/Upload/ClearTask",t),ClearCache:(t={})=>A(E+"/Upload/ClearCache",t),PushContDataTablex:(t="")=>$(F+"/UDReport/PushContDataTablex?",t),GetUploadProcess:(t={})=>A(E+"/Upload/GetUploadProcess",t)};const[_,z,G,M,V]=["SYSTEM_CATALOG","CUSTOM_CATALOG","B_AREA","CD_AREA","ALL"],W={sys:"SYSTEM_CATALOG",custom:"CUSTOM_CATALOG"},q={dirName:"全部",dirId:"",type:V},J={dirId:S["b"],type:"",dirName:"最新上传",dirPid:"",resTotal:0,childrenCatTree:[]},X={dirId:S["b"],type:S["b"],dirName:"最新上传",dirPid:""},K={dirId:S["c"],type:"",dirName:"未分类",dirPid:"",resTotal:"-",childrenCatTree:[]},H={dirId:S["b"],type:S["c"],dirName:"未分类",dirPid:""},Z=[S["b"],S["c"]],Y=20971520,Q=t=>{const e=B(t);return"UNKOWN"!==e};let tt=null;var et={components:{FilePathList:P},data(){return{FILE_MAX_SIZE:Y,customBucketId:"",currContId:"",userId:"",comId:"",token:"",projId:"",projName:"",contId:"",contName:"",projectList:"",contractList:"",currCatDirPid:"",specialFlagDirId:"",bucketType:"",fileCatalogList:[],searchShow:!1,isUploadShow:!0,isShowOptBtns:!1,isShowAddBtns:!1,isUploadBtnShow:!1,isEditFileShow:!1,editFormType:"",editValue:"",optConfig:[{name:"edit",text:"修改",availible:!1,icon:"",operation:this.onEdit},{name:"delete",text:"删除",availible:!1,icon:"",operation:this.handlerDelFile},{name:"move",text:"调拨",availible:!1,icon:"",operation:this.onMove},{name:"share",text:"分享",availible:!1,icon:"",operation:this.callShare},{name:"download",text:"下载",availible:!1,icon:"",operation:this.handleDownload}],underAllNode:!1,underNoGroup:!1,underNewGroup:!1,searchValue:"",searchResultCount:"",cacheSearchValue:"",mainPathList:[],checkboxResult:[],sourceBucketIds:[],resGroupCount:{},bizType:"system",showMoveFilePropup:!1,filePathList:[],currentPathIndex:-1,moveTargetDirList:[],previewImgList:[],projectContName:""}},watch:{showMoveFilePropup(t){t?(this.initMoveTargetDirList(),this.$appApi.changeRightBtn({type:"HIDE"})):this.handleShowRightBtn()}},created(){this.$nextTick(()=>{this.$appApi.changeRightBtn({type:"CLICK",title:"全选",func:"checkAll"}),this.$appApi.addEventRightBtn(()=>{this.testRightBtn()},"checkAll")})},mounted(){const t=this;setTimeout(()=>{this.getProjectList(),api.addEventListener({name:"handlerProjContChange"},e=>{console.log("--------------------"),console.log(JSON.stringify(e)),t.projectContName=e.value.title[0],t.onContChange({contId:e.value.conid[0].toUpperCase()}),localStorage.setItem("DRAWING-PROJ-ID",e.value.projId.toUpperCase()),localStorage.setItem("DRAWING-CONT-ID",e.value.conid[0].toUpperCase())}),api.addEventListener({name:"handleOpenContList"},t=>{console.log("---------图宝handleOpenContList-----------"),console.log(JSON.stringify(t))})},500)},methods:{callShare(){const t=this.fileCatalogList[this.checkboxResult[0]];let e;e=t.resId?`{objId:"${t.resId}",objType:"RES",type:"TEMP",objBucketId:"${this.customBucketId}",url:"https://page.jizhibao.com.cn/res/s"}`:`{objId:"${t.dirId}",objType:"DIR",type:"TEMP",objBucketId:"${this.customBucketId}",url:"https://page.jizhibao.com.cn/res/s"}`,console.log(`share(${e})`),setTimeout(()=>{api.execScript({name:api.winName,script:`share(${e})`})},500)},getProjectList(){const t={comId:this.$route.query.comid,userId:this.$route.query.userid};C.listBrief(t).then(t=>{if("30000"===t.code){if(0===t.list.length)return this.$toast("当前无项目，请去创建"),void this.handleNoProjCont();this.projectList=t.list;const e=localStorage.getItem("DRAWING-PROJ-ID");if(!e)return this.projId=t.list[0].projId,this.projName=t.list[0].projName,localStorage.setItem("DRAWING-PROJ-ID",this.projId),void this.getContractList();const i=t.list.find(t=>t.projId===e);if(!i)return this.projId=t.list[0].projId,this.projName=t.list[0].projName,localStorage.setItem("DRAWING-PROJ-ID",this.projId),void this.getContractList();this.projId=i.projId,this.projName=i.projName,this.getContractList()}else this.$toast(t.msg)})},async getContractList(){const t=`projid=${this.projId}&isgenerator=0&userid=${this.$route.query.userid}`,e=await U.ProjContContract(t);if(e.rows.length>0){this.contractList=e.rows;const t=localStorage.getItem("DRAWING-CONT-ID");if(!t)return this.contId=e.rows[0].cont_id.toUpperCase(),this.contName=e.rows[0].cont_name,localStorage.setItem("DRAWING-CONT-ID",this.contId),this.projectContName=this.contName,void this.onContChange({contId:this.contId});const i=e.rows.find(e=>e.cont_id.toUpperCase()===t);if(!i)return this.contId=e.rows[0].cont_id.toUpperCase(),this.contName=e.rows[0].cont_name,localStorage.setItem("DRAWING-CONT-ID",this.contId),this.projectContName=this.contName,void this.onContChange({contId:this.contId});this.contId=i.cont_id.toUpperCase(),this.contName=i.cont_name,this.projectContName=i.cont_name,this.onContChange({contId:this.contId})}else this.handleNoProjCont(),this.contName="",this.contId="",this.contractList=[],this.$toast("当前无合同，请去创建")},openChooseProjContWin(){setTimeout(()=>{api.execScript({name:api.winName,script:"chooseProjContWin('handlerProjContChange')"})},500)},openAppContListWin(){setTimeout(()=>{api.execScript({name:api.winName,script:"openContListWin('handleOpenContList')"})},500)},async onContChange({contId:t}){t?(this.contId=t,this.customBucketId=await this.getContAppEnsure(this.contId),this.queryRootList(),this.initPath(),this.switchUnderFlag()):(this.fileCatalogList=[],this.resGroupCount=[],this.mainPathList=[])},async queryRootList(){this.getFileCatalog("",W.custom)},async confimMove(){if(this.filePathList.length<2)return void this.$toast("当前目录不支持调拨，请选择下级文件夹");const t=new Map,e=new Map;let i=null;this.checkboxResult.forEach(s=>{i=this.fileCatalogList[s],i.resId?t.set(i.resId,i.sort):e.set(i.dirId,i.sort)});const{dirId:s}=this.filePathList[this.currentPathIndex];this.$toast({duration:0,type:"loading",message:"加载中...",forbidClick:!0,loadingType:"spinner"});const o=this.saveMoveFolder(e,this.customBucketId,s),a=this.saveMoveFile(t,this.customBucketId,s),c=await Promise.all([o,a]);c[0]&&c[1]&&(this.$toast.success("调拨成功"),this.showMoveFilePropup=!1,setTimeout(()=>{this.refreshPage()},800))},async saveMoveFolder(t,e,i){try{if(0===t.size)return!0;const s={};t.forEach((t,e)=>{s[e]=t});const o={bucketId:e,dirMap:s,newDirPid:i},a=await D.multiMove(o);return"30000"===a.code||(this.$toast(a.msg),!1)}catch(s){return!1}},async saveMoveFile(t,e,i){try{if(0===t.size)return!0;const s={bucketId:e,dirId:i,resIds:[...Array.from(t.keys())]},o=await x.move(s);return"30000"===o.code||(this.$toast(o.msg),!1)}catch(s){return!1}},async acrossCopyDir(t,e,i,s){if(0===i.length)return!0;const o={sourceBucketId:t,targetBucketId:e,fetchRes:!0,sourceDirIdList:i,targetDirPid:s,duplicateOpType:"UPDATE",duplicateRuleType:"DIR_NAME",updateProps:!0},a=await D.acrossCopy(o);if("30000"!==a.code)return this.$toast.fail(a.msg),!1;const c=await this.removeDir({bucketId:t,dirIds:i,force:!0});return c},async acrossCopyRes(t,e,i,s){if(0===i.length)return!0;const o={sourceBucketId:t,targetBucketId:e,resIds:i,targetDirId:s,duplicateOpType:"UPDATE"},a=await x.acrossCopy(o);if("30000"!==a.code)return this.$toast.fail(a.msg),!1;const c=await this.removeRes({bucketId:t,resIds:i});return c},async onClickDir(t){this.$toast({duration:200,type:"loading",message:"加载中...",forbidClick:!0,loadingType:"spinner"}),this.filePathList.push(t),this.moveTargetDirList=await this.fetchMoveDirList(t),this.currentPathIndex=this.filePathList.length-1,this.$toast.clear()},async handlerPathClick(t){if(this.currentPathIndex===t)return;this.currentPathIndex=t;const e=this.filePathList[t];if("ROOT_DIR"!==e.dirId){this.filePathList.splice(t+1);try{this.moveTargetDirList=await this.fetchMoveDirList(e)}catch(i){this.$toast.fail("程序异常，请稍后再试"),this.moveTargetDirList=[]}}else this.initMoveTargetDirList()},async initMoveTargetDirList(){this.filePathList=[{...q,dirId:"ROOT_DIR"}];const t=await this.getDirList({bucketId:this.customBucketId,depth:1,fetchRes:!0,countRes:!0});this.moveTargetDirList=t.filter(t=>1!==t.type)},async fetchMoveDirList({dirId:t,bucketId:e}){const i=this.checkboxResult.some(t=>{const e=this.fileCatalogList[t];return 2===e.type});console.log("------------当前选中的包含",i);try{const s={dirPid:t,bucketId:e,depth:1},o=await D.list(s);return"30000"!==o.code&&(o.list=[],this.$toast.fail(o.msg)),i||t===this.customBucketId?o.list.filter(t=>1!==t.type):o.list}catch(s){return this.$toast.fail("程序异常，请稍后再试"),[]}},handlerDelFile(){0!==this.checkboxResult.length?b["Dialog"].confirm({title:"删除",message:"是否继续删除这些文件?",confirmButtonColor:"#1989fa"}).then(async()=>{const t=[],e=[];let i=null;this.checkboxResult.forEach(s=>{i=this.fileCatalogList[s],i.resId?t.push(i.resId):e.push(i.dirId)});const s={bucketId:this.customBucketId,dirIds:e,resIds:t},o=await Promise.all([this.removeDir(s),this.removeRes(s)]);o[0]&&o[1]&&(this.$toast.success("删除成功"),setTimeout(()=>{this.refreshPage()},800))}):this.$toast("请勾选需要删除的文件")},async removeRes(t){try{if(0===t.resIds.length)return!0;const e=await x.multiRemove(t);return"30000"===e.code||(this.$toast.fail(e.msg),!1)}catch(e){return console.log(e),!1}},async removeDir(t){try{if(0===t.dirIds.length)return!0;const e=await D.batchRemove(t);return"30000"===e.code||(this.$toast.fail(e.msg),!1)}catch(e){return console.log(e),!1}},handleCheckClick(){},getEditFormTitle(){return"add"===this.editFormType?"新建文件夹":"editF"===this.editFormType?"修改文件夹名称":"editR"===this.editFormType?"修改图纸名称":""},onAddFolder(){this.showEditForm(!0,"add")},onEdit(){if(1!==this.checkboxResult.length)return void console.log("非单选，选中出错");const t=this.fileCatalogList[this.checkboxResult[0]];if(t.resId){this.showEditForm(!0,"editR");let e=t.title.lastIndexOf(".");-1===e&&(e=t.title.length),this.editValue=t.title.substring(0,e)}else this.showEditForm(!0,"editF"),this.editValue=t.title},editValidator(t){return console.log(t),console.log(this.editValue),t.length<=30&&t.length>0},onFailed(t){console.log("failed",t)},showEditForm(t,e){t?(this.editFormType=e,this.isEditFileShow=!0):(this.isEditFileShow=!1,setTimeout(()=>{this.editValue="",this.$refs.editForm.resetValidation()},300))},onEditPopupClose(){this.showEditForm(!1)},async confirmEdit(){if("add"===this.editFormType){const e={bucketId:this.customBucketId,bucketType:1,dirPid:this.currCatDirPid,dirName:this.editValue,type:2};if(this.bucketType===G){const t=this.fileCatalogList.filter(t=>t.dirId&&!Z.includes(t.type));e.sort=t.length+1}else this.bucketType===M&&(e.type=1,e.sort=1);try{const t=await D.create(e);"30000"!==t.code?this.$toast.fail(t.msg):this.$toast.success("新建成功")}catch(t){this.$toast.fail(t),console.log(t)}}else if("editF"===this.editFormType||"editR"===this.editFormType){const t=this.fileCatalogList[this.checkboxResult[0]];let e;if(console.log(t.title),t.resId){let i;i=-1===t.title.lastIndexOf(".")?"":t.title.substring(t.title.lastIndexOf("."),t.title.length),console.log(i);const s=`${this.editValue}${i}`,o={bucketId:this.customBucketId,resId:t.resId,title:s};e=await x.update(o)}else{const i={dirId:t.dirId,dirName:this.editValue};e=await D.update(i)}"30000"===e.code?this.$toast.success("修改名称成功"):this.$toast.fail(e.msg)}this.showEditForm(!1),this.isShowAddBtns=!1,setTimeout(()=>{this.refreshPage()},800)},onMove(){this.showMoveFilePropup=!0},handleDownload(){const t=this.fileCatalogList[this.checkboxResult[0]],e=`https://api.jizhibao.com.cn/file/download/res/${t.resId}?token=${Object(S["a"])().token}`;console.log(t,e),this.downloadCAD(e,t.title)},downloadCAD(t,e){api.execScript({name:api.winName,script:`downFile( '${t}', '${e}', false)`})},handleCheckChange(t){const e=JSON.parse(JSON.stringify(t)),i=this.underNoGroup||this.underNewGroup||this.underAllNode;if(this.bucketType===G)1===e.length?this.configOptBtn(["edit","delete"]):e.length>1&&this.configOptBtn(["delete"]);else if(this.bucketType===M)if(1===e.length){const t=this.fileCatalogList[this.checkboxResult[0]];t.resId?this.configOptBtn(["edit","delete","move","share","download"]):this.configOptBtn(["edit","delete","move","share"])}else e.length>1&&this.configOptBtn(["delete","move"]);else if(i)if(this.isUploadShow=!1,1===e.length){const t=this.fileCatalogList[this.checkboxResult[0]];t.resId?this.configOptBtn(["edit","delete","share","download"]):this.configOptBtn(["edit","delete","share"])}else e.length>1&&this.configOptBtn(["delete"]);this.handleShowRightBtn()},handleShowRightBtn(){const t=this.checkboxResult;this.fileCatalogList.length>0?0===t.length?(this.setRightBtnStatus(1),this.isShowOptBtns=!1,this.isUploadShow=!0):t.length>0&&t.length<this.fileCatalogList.length?(this.isShowOptBtns=!0,this.isUploadShow=!1,this.setRightBtnStatus(1)):(this.isShowOptBtns=!0,this.isUploadShow=!1,this.setRightBtnStatus(2)):(this.setRightBtnStatus(0),this.isShowOptBtns=!1,this.isUploadShow=!0),this.underNewGroup&&(this.isUploadShow=!1)},setRightBtnStatus(t){switch(t){case 0:this.$appApi.changeRightBtn({type:"HIDE"});break;case 1:this.$appApi.changeRightBtn({type:"CLICK",title:"全选",func:"checkAll"}),this.$appApi.addEventRightBtn(()=>{this.handleAllCheck()},"checkAll");break;case 2:this.$appApi.changeRightBtn({type:"CLICK",title:"取消勾选",func:"uncheckAll"}),this.$appApi.addEventRightBtn(()=>{this.handleAllUncheck()},"uncheckAll");break;default:break}},handleAllCheck(){this.$refs.checkGroup.toggleAll(!0),console.log(this.checkboxResult)},handleAllUncheck(){this.clearCheckGroup()},configOptBtn(t){for(let e=0;e<this.optConfig.length;e+=1){const i=this.optConfig[e];t.includes(i.name)?i.availible=!0:i.availible=!1}},onClickAdd(){this.isUploadShow=!1,this.isShowAddBtns=!0},beforeRead(t){console.log(t);const e=t.name.lastIndexOf(".");if(-1===e)return this.htmlToast(),!1;const i=t.name.substring(e,t.name.length);return"CAD"===B(i)||(this.htmlToast(),!1)},handlerAfterRead(t){let e=[];t instanceof Array?e=t:t instanceof Object&&e.push(t);const i=e.filter(({file:t})=>Q(t.name));this.$toast({duration:0,type:"loading",message:"文件上传中...",forbidClick:!0,loadingType:"spinner"}),this.uploadFileFn(i)},async uploadFileFn(t){if(!t||0===t.length)return void this.$toast.clear();const e=this,i=new FormData;t.forEach(({file:t})=>{i.append("file",t)});const s=`?bizkey=${this.bizType}/${e.currCatDirPid}/${g()}`;try{const t=await T.uploadBizMulti(i,{headers:{"content-type":"application/x-www-form-urlencoded"}},s);if(console.log("upload result",t),"30000"!==t.code)throw new Error(t.msg);t.files.forEach(t=>{t.name=`${t.name}.${t.fileFormat}`});const e=await this.imptFileRes(t.files);console.log("----------导入结果",e),this.$toast.clear(),e.length>0&&this.refreshPage(),this.getDirList(tt),this.isShowAddBtns=!1}catch(o){this.$toast.clear(),console.error("ex =>",o),this.$toast.fail(o.message)}},async imptFileRes(t){const e=t.map(t=>({dirId:this.currCatDirPid,fileId:t.id,bizid:g,biztype:t.bizkey.substr(0,16),title:t.name,props:{settle_cont_checked:"0"}})),i={list:e,bucketId:this.customBucketId},s=await x.impt(i);if("30000"!==s.code)throw new Error(s.msg);return s.resources},previewFile(t){const{type:e,bucketId:i,resId:s,title:o}=t,a=B(e);if("CAD"!==a)return void this.$message.error("图纸中只支持预览CAD, 当前格式不支持预览");const c=Object(S["a"])().token,r=`https://page.jizhibao.com.cn/res/drawing/PreviewCAD?jtype=${a}&jbucketId=${i||""}&jresId=${s}&token=${c}`;console.log(r),setTimeout(()=>{api.execScript({name:api.winName,script:`previewCadFile( '${r}', '${o}')`})},300)},onOversize(){this.$toast("大于20M，请去PC端上传")},async fetchDirList(t){try{const e=await D.searchDirList(t);"30000"===e.code?this.resGroupCount=e.resGroupCount:console.log(e.msg)}catch(e){throw this.$toast.fail("程序异常"),new Error("程序异常")}},async getContAppEnsure(t="",e=L.appName.Drawing_2D_BUCKET){try{const i=await R.ensure({contId:t,appName:e});return"30000"!==i.code?(this.$toast(i.msg),""):i.app.bucketId}catch(i){return console.error("errMsg",i),""}},async onClickCell(t){console.log("---------点击cell",t),t&&(t.resId?this.previewFile(t):(this.bucketType="",t.bucketId?this.getFileCatalog(t.dirId,t.type,t.sys,t.bucketId):t.dirPid&&Z.includes(t.type)?this.getFileCatalog(t.dirPid,t.type):this.getFileCatalog(t.dirId,t.type,t.sys)))},async getFileCatalog(t,e){let i,s={bucketId:this.customBucketId,depth:1,fetchRes:!0,countAllRes:!0};this.$toast({duration:0,type:"loading",message:"加载中...",forbidClick:!0,loadingType:"spinner"}),e===W.custom?(this.bucketType=G,s={...s},i=await this.getDirList(s),this.currCatDirPid=this.customBucketId):2===Number(e)||1===Number(e)?(this.bucketType=M,s={dirPid:t,...s},i=await this.getDirList(s),this.currCatDirPid=t):e===S["b"]?(this.bucketType=S["b"],i=await this.getAllResourceFile(t),this.currCatDirPid=t,this.isUploadShow=!1):e===S["c"]&&(this.bucketType=S["c"],s={dirPid:t,...s},i=await this.getDirList(s),this.currCatDirPid=t,this.isUploadShow=!1),Z.includes(e)&&(this.switchUnderFlag(e),this.setSpecialFlagId(t)),this.$toast.clear(),this.clearSearch(),this.showCatalogList(i),this.clearCheckGroup(),this.showPathList()},async refreshPage(){if(""===this.contId)return void console.log("-----------当前无合同");let t,e;this.$toast({duration:0,type:"loading",message:"加载中...",forbidClick:!0,loadingType:"spinner"}),this.bucketType===S["b"]?t=await this.getAllResourceFile(this.currCatDirPid):this.bucketType===_||this.bucketType===z?(e={bucketId:this.customBucketId,depth:1},t=await this.getDirList(e)):(e={bucketId:this.customBucketId,dirPid:this.currCatDirPid,countAllRes:!0,depth:1,fetchRes:!0},t=await this.getDirList(e)),this.$toast.clear(),this.clearSearch(),this.showCatalogList(t),this.clearCheckGroup(),this.showPathList()},async getDirList(t){tt={...t};const e=await D.list(t);try{if("30000"!==e.code){if("20051"===e.code){await this.initBucketId();const e=await this.getDirList(t);return e}return this.$toast(e.msg),[]}if(this.bucketType===G){this.isUploadShow=!0,this.isUploadBtnShow=!1,J.dirPid=this.customBucketId,J.type=S["b"];const t=t=>2===t.type,i=t=>1===t.type,s=e.list.some(i);J.resTotal=e.resGroupCount.resTotal;let o=[J,...e.list.filter(t)];const a=await x.list({bucketId:this.customBucketId,dirId:this.customBucketId});return("30000"===e.code&&a.list.length>0||s)&&(K.dirPid=this.customBucketId,K.type=S["c"],o=[J,K,...e.list.filter(t)]),o}if(this.bucketType===M){this.isUploadShow=!0,this.isUploadBtnShow=!0;const t=e.resource;return t?[...e.list,...t]:e.list}if(this.bucketType===S["b"]){this.isUploadShow=!1;const t=t=>1===t.type,i=e.list.filter(t),s=e.resource;return s?[...i,...s]:i}if(this.bucketType===S["c"]){const t=t=>1===t.type,i=e.list.filter(t),s=e.resource;return s?[...i,...s]:i}return e.list}catch(i){return this.$toast(i),console.log(i),[]}},handleNoProjCont(){this.isUploadShow=!1},async initBucketId(){const t={bucketId:this.customBucketId},e=await D.createBucket(t);"30000"!==e.code&&this.$toast(e.msg)},async getAllResourceFile(t){const e={bucketId:this.customBucketId,dirId:t,fetchChilds:!0};try{const t=await x.list(e);return"30000"!==t.code?(this.$toast(t.msg),[]):t.list}catch(i){return this.$toast(i),console.log(i),[]}},showCatalogList(t){console.log("当前bucket type: ",this.bucketType);const e=[];this.fileCatalogList=t.map(t=>{if(!t.resId){const{dirName:e,modifiedTime:i,dirId:s,type:o,code:a,dirPid:c,bucketId:r,sort:l,sys:n,resTotal:d}=t;return{title:e,modifiedTime:i,dirId:s,type:o,code:a,dirPid:c,bucketId:r,sort:l,sys:n,resTotal:d}}const{title:i,modifiedTime:s,fileId:o,resId:a,type:c,bucketId:r,sort:l}=t;return"IMAGE"===c&&e.push("https://api.jizhibao.com.cn/file/download/previewRes/"+a),{title:i,modifiedTime:s,fileId:o,resId:a,type:c,bucketId:r,sort:l}}),this.previewImgList=e},initPath(){this.mainPathList=[]},async showPathList(){const t={bucketId:this.customBucketId,dirIds:[this.currCatDirPid]},e=await D.multiGetPath(t);if(Object.hasOwnProperty.call(e.map,this.currCatDirPid)){const t=e.map[this.currCatDirPid];this.mainPathList=[...this.deepDirPathName(t)]}},deepDirPathName(t){const e=this;if(!t)return"";let i=[],{dirName:s,type:o,dirId:a,code:c,sys:r}=t;return a===this.customBucketId&&(s="全部",o=W.custom),i=[{dirName:s,type:o,dirId:a,code:c,sys:r}],a===this.customBucketId&&this.underNewGroup?(X.dirPid=this.customBucketId,i.push(X)):a===this.customBucketId&&this.underNoGroup&&a===this.specialFlagDirId&&(H.dirPid=a,i.push(H)),t.children&&t.children.length>0&&(i=i.concat([...e.deepDirPathName(t.children[0])])),i},onClickPath(t){this.bucketType=[];const e=this.mainPathList[t];e.type&&Z.includes(e.type)&&this.switchUnderFlag(e.type),(3===e.type||e.sys||e.type===_||e.type===z)&&this.switchUnderFlag(),Z.includes(e.type)?this.getFileCatalog(e.dirPid,e.type,e.sys):this.getFileCatalog(e.dirId,e.type,e.sys)},resTypeToIcon(t){return Object(S["d"])(t)},onFocus(){this.cacheSearchValue=this.searchValue},async onSearch(){if(""===this.searchValue)return;const t={bucketId:this.customBucketId,dirPid:this.currCatDirPid,fetchRes:!0,groupCount:!0,countRes:!0,countDir:!0,keyWord:this.searchValue};this.$toast({duration:0,type:"loading",message:"加载中...",forbidClick:!0,loadingType:"spinner"}),this.fileCatalogList=[];const e=await D.searchDirList(t);if("30000"!==e.code)return this.$toast("搜索错误！"),void(this.searchResultCount=0);if(this.$toast.clear(),this.searchShow=!0,0===e.searchs.length)return void(this.searchResultCount=0);const i=t=>{if(!t)return"";const e=t.split(">");e[0]="全部";const i=e.length;return i<3?`位置：${e[0]} >`:`位置：${e[i-3]} - ${e[i-2]} >`};let s=[];s=e.searchs.filter(t=>1===t.dirType||"RES"===t.exptType),this.searchResultCount=s?s.length:0;const o=[],a=[];s.forEach(t=>{"DIR"===t.exptType?o.push({title:t.name,dirId:t.dirId,type:t.dirType,path:i(t.path),dirPid:t.dirPid,bucketId:t.bucketId,sys:t.sys}):"RES"===t.exptType&&a.push({title:t.name,dirId:t.id,resId:t.id,type:t.type,path:i(t.path),dirPid:t.dirId,bucketId:t.bucketId})}),this.fileCatalogList=[...o,...a]},handleClearSearch(){this.clearSearch(),this.refreshPage()},clearCheckGroup(){this.$refs.checkGroup.toggleAll(!1),this.checkboxResult=[]},clearSearch(){this.searchShow=!1,this.searchValue=""},onClickCellPath(t){console.log("-----------点击搜索cell",t),t.bucketId&&this.getFileCatalog(t.dirPid,2,!1,t.bucketId)},switchUnderFlag(t){t===S["b"]?(this.underAllNode=!1,this.underNewGroup=!0,this.underNoGroup=!1):t===S["c"]?(this.underAllNode=!1,this.underNewGroup=!1,this.underNoGroup=!0):(this.underAllNode=!1,this.underNewGroup=!1,this.underNoGroup=!1)},setSpecialFlagId(t){this.specialFlagDirId=t},htmlToast(){this.$toast({message:'<div><i class="iconfont icon icon-shuomingwenzi" style="color:rgb(255,255,255);font-size:16px;margin-right:5px;transform:rotate(180deg);-webkit-transform:rotate(180deg);display:inline-block"></i><span>请上传CAD格式的文件！</span></div>',type:"html"})},testToast(t){this.$toast(t)}}},it=et,st=(i("a631"),Object(j["a"])(it,o,a,!1,null,"bac3bae0",null));e["default"]=st.exports}}]);